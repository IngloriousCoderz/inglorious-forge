import { Meta } from '@storybook/addon-docs/blocks'

import { toString } from '@inglorious/utils/math/vector.js'
import { v, ensureV } from '@inglorious/utils/v.js'

<Meta title="Utils/Docs" />

# Utilities

This section contains a collection of small, reusable, pure functions designed to handle common tasks within the engine and your games.

## Design Philosophy

The functions in this section are heavily inspired by the design philosophy of libraries like [date-fns](https://date-fns.org/). Each function is:

- **Focused**: It does one thing and does it well.
- **Pure**: It doesn't have side effects and returns a new value instead of modifying its inputs. This aligns perfectly with the engine's immutable state management.
- **Composable**: You can easily combine them to build more complex logic, which is a core tenet of functional programming.

We believe this approach leads to more readable, testable, and maintainable code.

## Installation & Usage

All utilities are bundled in the `@inglorious/utils` package. You can install it via npm:

```bash
npm install @inglorious/utils
```

Then, you can import the namespaces you need in your project:

```javascript
import { math, dataStructures } from '@inglorious/utils';

const sum = math.vectors.sum([1, 2], [3, 4]);
```

Alternatively, you can import individual functions directly. This can be useful for tree-shaking and is often handled automatically by modern IDEs:

```javascript
import { sum } from '@inglorious/utils/math/vectors';

const result = sum([1, 2], [3, 4]);
```

## Available Utilities

The following namespaces are available. Explore them to see what you can use in your own game logic.

- **[Data Structures](/docs/utils-data-structures-object--docs)**: For specialized data structures like graphs or trees.
- **[Functions](/docs/utils-functions-functions--docs)**: General-purpose functional programming helpers.
- **[Math](/docs/utils-math-numbers--docs)**: For vector math, random number generation, and other calculations.
- **[Physics](/docs/utils-physics-friction--docs)**: For simple physics calculations like collisions.

## v

The `v` function is a special, top-level export for creating vectors. It's a convenient shorthand for `[x, y, z, ...]`.

<code>v(1, 2, 3) == {toString(v(1, 2, 3))}</code>&nbsp;

<code>v() == {toString(v())}</code>&nbsp;

## ensureV

The `ensureV` function is a utility to guarantee that a value is a vector. It's especially useful after performing standard array operations on a vector, like `.map()` or `.filter()`, which return a new, plain array. `ensureV` will re-tag this array as a vector.

- If the value is an array of numbers but not a vector, it's converted to one.
- If the value is already a vector, it's returned as is.
- If the value is not a numeric array (e.g., a string, number, or an array of other types), it's returned unchanged.

Here's an example of how you might use it:

```javascript
import { v, ensureV } from '@inglorious/utils/v';

const vector = v(1, 2, 3);
const plainArray = vector.map(x => x * 2); // [2, 4, 6]
const newVector = ensureV(plainArray); // v(2, 4, 6)

console.log(plainArray.__isVector__); // undefined
console.log(newVector.__isVector__); // true
```

<code>ensureV([1, 2, 3]) == {toString(ensureV([1, 2, 3]))}</code>
